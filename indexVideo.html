<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Albert+Sans:ital,wght@0,100..900;1,100..900&family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">
    <title>Luciano Candotti | Diseñador Gráfico, Desarrollador Front-End</title>
</head>
<body>
    <!-- intro ------------------------------------------------------------------------------------------------------------ -->
    <section id="intro">
        <div class="container">
            <h1 class="text-dark pt-5">Mi nombre es <span class="fw-bold">Luciano Candotti,</span><br>soy Diseñador Gráfico—Audiovisual con 15+ años de experiencia.</h1>

            <h2 class="py-3 fw-light">Me especializo en <span class="fw-semibold">Branding y Desarrollo Front-End,</span> este último como fortaleza, pues implemento en código mi habilidad estética.</h2>

            <!-- <p>click para jugar <i class="bi bi-arrow-down align-text-middle fs-6"></i></p> -->
            <a id="color" href="#"><h3 class="pb-4 fw-light">
            <i class="bi bi-arrow-repeat fs-4 pe-2" style="position: relative; top: -3px;"></i>Si funciona en blanco y negro = funciona siempre.<h3></a>
    <!-- about ------------------------------------------------------------------------------------------------------------- -->
            <section class="row mb-3">
                <div class="col-12 col-md-6 mb-md-0 h6 lh-base">
                    <p>Mi habilidad primaria es la <span class="fw-semibold">claridad para abordar problemas complejos con soluciones simples</span> <span class="fst-italic">a primera vista.</span> Esto, respaldado por un control estético que no sólo vuelve a todo más atractivo, sino que ayuda en la <span class="fw-semibold">interacción [UI-UX]</span> con el programa y en la asimilación de la información [Conversión].</p>
                </div>
                <div class="col-12 col-md-6 text-md-0 h6 lh-base">  
                    <p>Manejo <span class="fw-semibold">HTML | CSS | Javascript Nativos [Plano]:</span> lo que me permite realizar sitios web dinámicos completamente customizables. Así mismo utilizo librerías como <span class="fw-semibold">Bootstrap,</span> para cuando el tiempo es corto.</p>

                        <div class="form-check form-switch me-2">
                            <input class="form-check-input" type="checkbox" id="skillsToggle" style="position: relative; top: -0.1px;" data-bs-toggle="collapse" data-bs-target="#skills">
                            <label id="toggle" class="form-check-label" for="skillsToggle">Habilidades técnicas</label>
                        </div>
                    </p>
                </div>
            </section>
    <!-- skills --------------------------------------------------------------------------------------------------------- -->
            <section class="collapse mt-3" id="skills">
                <div class="row mb-3">
                    <div class="col-12 col-md-6 mb-md-0 h6 lh-base">
                        <h2 class="h5 pb-3 fw-light">Conocimientos</h3>
                        <table class="table h6 fw-light">
                            <tbody>
                              <tr>
                                <th class="ps-0 fw-semibold" scope="row">Diseño gráfico</th>
                                <td class="text-end pe-0">100%</td>
                              </tr>
                              <tr>
                                <th class="ps-0 fw-semibold" scope="row">Fotografía</th>
                                <td class="text-end pe-0">100%</td>
                              </tr>
                              <tr>
                                <th class="ps-0 fw-semibold" scope="row">Retoque fotográfico</th>
                                <td class="text-end pe-0">100%</td>
                              </tr>
                              <tr>
                                <th class="ps-0 fw-semibold" scope="row">Filmación</th>
                                <td class="text-end pe-0">100%</td>
                              </tr>
                              <tr>
                                <th class="ps-0 fw-semibold" scope="row">Edición de video</th>
                                <td class="text-end pe-0">100%</td>
                              </tr>
                              <tr>
                                <th class="ps-0 fw-semibold" scope="row">Programación FrontEnd</th>
                                <td class="text-end pe-0">60%</td>
                              </tr>
                              <tr>
                                <th class="ps-0 fw-semibold" scope="row">Ilustración digital</th>
                                <td class="text-end pe-0">50%</td>
                              </tr>
                              <tr>
                                <th class="ps-0 fw-semibold" scope="row">Animación en AfterEffect</th>
                                <td class="text-end pe-0">30%</td>
                              </tr>
                              <tr>
                                <th class="ps-0 fw-semibold" scope="row">Campañas en redes sociales <span class="fw-light">[Google Ads - Meta Bussines].</span></th>
                                <td class="text-end pe-0">20%</td>
                              </tr>
                            </tbody>
                          </table>
                    </div>
                    <div class="col-12 col-md-6 text-md-0 h6 lh-base">
                        <h2 class="h5 pb-3 fw-light">Idiomas</h3>
                        <table class="table h6 fw-light">
                            <tbody>
                              <tr>
                                <th class="ps-0 fw-semibold" scope="row">Español</th>
                                <td class="text-end pe-0">100%</td>
                              </tr>
                              <tr>
                                <th class="ps-0 fw-semibold" scope="row">Português</th>
                                <td class="text-end pe-0">90%</td>
                              </tr>
                              <tr>
                                <th class="ps-0 fw-semibold" scope="row">English</th>
                                <td class="text-end pe-0">75%</td>
                              </tr>
                            </tbody>
                          </table>
                    </div>
                </div>
            </section>
        </div>
    </section>

    <!-- contenedor de proyecto abierto ----------------------------------------------------------------------------------- -->
    <section id="project"></section>
    <section id="galeria">
        <!-- Header de la sección con el filtro -->
        <header class="container text-end mb-3">
            <select id="categoryFilter" class="form-select focus-custom rounded-0" aria-label="Filtro">
            </select>
        </header>
        
        <!-- Contenedor de la galería de proyectos -->
        <div id="output"></div>
    </section>


   <script>

    let category = '';
    let filtro = false;
    getGrilla();

    // Convertimos en Array los datos de Category dentro del JSON
    /* Se utiliza en dos intancias, primero se genera la lista de <select> y luego cada vez que se carga una categoría en la galería */
    function parseCategories(categoryString) {
        if (!categoryString) return [];
  
        return categoryString
            .replace(/^\[|\]$/g, '') // Quita corchetes solo si están al principio/final
            .split(',')
            .map(cat => cat.trim())
            .filter(cat => cat.length > 0); // Elimina categorías vacías
    }

    /* Esta función se debe ejecutar después de cargar el JSON
    Lo que hace es leer todas las categorías presentes en el JSON y hacer una lista para ponerla dentro del desplegable <select> */
    function generarSelectorCategorias(data) {
        // Guardar la selección actual
        const seleccionActual = document.getElementById('categoryFilter').value;
        // Crear un conjunto para almacenar categorías únicas
        const categoriasUnicas = new Set();
        
        // Recorrer todos los elementos del JSON
        data.forEach(post => {
            const categorias = parseCategories(post.category);
        
            // Añadir cada categoría al conjunto
            categorias.forEach(cat => {
                if (cat) categoriasUnicas.add(cat);
            });
        });
        
        // Convertir el conjunto a un array y ordenarlo alfabéticamente
        const arrayCategorias = Array.from(categoriasUnicas).sort();
        
        // Crear las opciones HTML usando map
        const opcionesHTML = arrayCategorias.map(cat => 
        `<option value="${cat}">${cat.charAt(0).toUpperCase() + cat.slice(1)}</option>`
        ).join('');
        
        // Crear la opción "Todos los proyectos"
        const opcionTodos = '<option value="" selected>Todos los proyectos</option>';
        
        // Actualizar el HTML del select
        document.getElementById('categoryFilter').innerHTML = opcionTodos + opcionesHTML;
        // Establecer la selección anterior
        document.getElementById('categoryFilter').value = seleccionActual;
    }

    // ESTA FUNCION CARGA LA GRILLA DE PROYECTOS ------------------------------------------------------------------------- //
    function getGrilla() {
        fetch('post.json')
        .then((res) => res.json())
        .then((data) => {
            // Generar las opciones del selector de forma dinámica
            generarSelectorCategorias(data);
            // Mostramos algún indicador de carga
            document.getElementById('output').innerHTML = '<div class="text-center p-5"><div class="spinner-border" role="status"><span class="visually-hidden">Cargando...</span></div></div>';
            
            // Creamos un array para almacenar todas las promesas de carga de imágenes
            const imagePromises = [];
            let output = '';

            // Filtramos data acá
            const dataFiltrada = data.filter(post => {
                // Si el filtro está vacío (''), devolver todos los elementos
                if (category === '') {
                    return true; // Esto se llama retorno temprano, para evitar cálculos innecesarios. Todo lo que sigue en la function no se ejecuta
                }
                /* Solo cuando category tiene un valor, necesitamos hacer el trabajo adicional de parsear la cadena y verificar si incluye la categoría buscada. */
                const categorias = parseCategories(post.category);
                // Verifica si la categoría que buscamos está en el array
                return categorias.includes(category);
            });


            dataFiltrada.forEach(function(post){
                /* Construímos los divs con la info + las imgs

                Dentro del div usamos col-lg-4 separa la grilla en 3 en pantalla grande
                col-md-6 separa la grilla en 3 en pantalla mediana, y en pequeño se apila todo a 1 columna
                img-fluid es para que sea flexbox  */
                const imgPath = `./img/${post.id}/1.jpg`;

                output += `
                    <div id="${post.id}" class="col-lg-4 col-md-6 pb-4">
                        <div class="card bg-light px-3 shadow-lg rounded-0">
                            <h3 class="fs-4 text-dark pt-3 pb-2">${post.title}</h3>
                            <div class="overflow-hidden">
                                <a href="javascript:getProject('${post.id}')">${/* acá es donde elegimos qué proyecto deseamos cargar*/''}
                                   <img class="img-fluid rounded-0 hover-zoom" style="transition: transform 0.5s ease;" src="./img/${post.id}/1.jpg">
                                </a>
                            </div>
                            <p class="pt-3 text-muted">${post.intro}</p>
                        </div>
                    </div>
                `;

                // Creamos una promesa para cada imagen
                const imagePromise = new Promise((resolve, reject) => {
                    const tempImg = new Image();
                    tempImg.onload = () => resolve();
                    tempImg.onerror = () => reject();
                    tempImg.src = imgPath;
                });
                
                imagePromises.push(imagePromise);
            });

            let galeria =`
                <div class="container py-4">
                    <div class="row">
                        ${output}
                    </div>
                </div>
            `;

            Promise.all(imagePromises)
                .then(() => {
                // Todas las imágenes se han cargado, actualizamos el contenido y navegamos
                /* 
                Inicialmente usaba document.getElementById('output').innerHTML = proyecto; 
                Hablando con Claude y estudiando con Traversy, veo que este tipo de prácticas 'linyeras' pueden llevar a problemas cuando una app web es más grande de lo que estoy manejando ahora, o supongo, en un dispositivo viejo o con poca capacidad.
                */
                const temp = document.createElement('div');
                temp.innerHTML = galeria;
                document.getElementById('output').replaceChildren(...temp.childNodes);

                if (filtro === true){
                    document.getElementById('categoryFilter').scrollIntoView({ behavior: "smooth" });
                    filtro = false; // Resetear la bandera para futuras acciones
                }

                console.log('se cargó todo en la galeria');
                })
                .catch(() => {
                // En caso de error en alguna imagen, mostramos el contenido de todas formas
                const temp = document.createElement('div');
                temp.innerHTML = galeria;
                document.getElementById('output').replaceChildren(...temp.childNodes);
                });
        })
    };

    // Cambio al selector de categorías
    document.getElementById('categoryFilter').addEventListener('change', function() {
        // Actualizar la variable category con el valor seleccionado
        category = this.value;
        console.log('Categoría seleccionada:', category);
    
        // Volver a ejecutar getGrilla para actualizar la visualización
        filtro = true;
        getGrilla();
    });


    // ESTA FUNCION CARGA EL PROYECYO (arriba de la galería) --------------------------------------------------------------- //

    function getProject(id) {
        fetch('post.json')
        .then((res) => res.json())
        .then((data) => {
            // Encontramos el proyecto con id al que hicimos click
            const project = data.find(project => project.id === id);

            // Verificamos que encontramos el proyecto
            if (project) {
                // Posicionamos el scroll
                document.getElementById('project').scrollIntoView({ behavior: "smooth" });
                // Mostramos algún indicador de carga
                document.getElementById('project').innerHTML = '<div class="text-center p-5"><div class="spinner-border" role="status"><span class="visually-hidden">Cargando...</span></div></div>';
            
                const imagePromises = [];
                let imgInsert = '';

                for (let img = 2; img <= project.cant; img++) {
                if (project.video != '') {
                    const cantidad = project.cant - project.video;
                        // Hay imagenes y videos
                        if (img <= cantidad) {
                        // Es una imagen
                        const imgPath = `./img/${project.id}/${img}.jpg`;
                        imgInsert += `<img class="img-fluid pb-4" src="${imgPath}">`;
                        
                        // Creamos una promesa para la imagen
                        const imagePromise = new Promise((resolve, reject) => {
                            const tempImg = new Image();
                            tempImg.onload = () => resolve();
                            tempImg.onerror = () => reject();
                            tempImg.src = imgPath;
                        });
                        imagePromises.push(imagePromise);
                        } else {
                        // Es un video
                        const videoPath = `./img/${project.id}/${img}.mp4`;
                        imgInsert += `<video class="w-100 pb-4" controls playsinline poster src="${videoPath}"></video>`;
                        
                        // Creamos una promesa para el video
                        const videoPromise = new Promise((resolve, reject) => {
                            const tempVideo = document.createElement('video');
                            tempVideo.onloadeddata = () => resolve();
                            tempVideo.onerror = () => reject();
                            tempVideo.src = videoPath;
                        });
                    imagePromises.push(videoPromise);
                    }
                } else {
                    // Solo hay imágenes
                    const imgPath = `./img/${project.id}/${img}.jpg`;
                    imgInsert += `<img class="img-fluid pb-4" src="${imgPath}">`;
                    
                    // Creamos una promesa para la imagen
                    const imagePromise = new Promise((resolve, reject) => {
                    const tempImg = new Image();
                    tempImg.onload = () => resolve();
                    tempImg.onerror = () => reject();
                    tempImg.src = imgPath;
                    });
                    imagePromises.push(imagePromise);
                }
            }
  
            // Construimos el contenedor con todas las imágenes
            /* 
                Esto es lo que teóricamente está mal, porque en vez de crear los elementos ortodoxamente, lo estoy haciendo en modo 'linyera', por el momento es un proyecto chico y no parece haber problemas, pero debo considerarlo cuando codee programas más robustos.
            */
            let proyecto = `
                <div class="container pt-5">
                <h1 class="pb-4 text-dark">${project.title}</h1>
                <h2 class="pb-3 text-dark fw-light">${project.descript}</h2>
                <div class="row mb-4">
                    <div class="col-12 col-md-6 mb-3 mb-md-0">
                    <p>${project.intro}</p>
                    </div>
                    <div class="col-12 col-md-6 text-md-end">
                    <p>${project.date}<br><a id="linkIcon" href="https://${project.link}/" target="_blank"><i class="bi bi-link-45deg align-text-middle fs-5 pe-2"></i>${project.link}</a></p>
                    </div>
                </div>

                    <div class="row">
                        ${imgInsert}
                    </div>

                </div>
            `;
  
            // Esperamos a que todas las imágenes se carguen antes de mostrar el contenido
            Promise.all(imagePromises)
                .then(() => {
                // Todas las imágenes se han cargado, actualizamos el contenido y navegamos
                const temp = document.createElement('div');
                temp.innerHTML = proyecto;
                document.getElementById('project').replaceChildren(...temp.childNodes);

                detenerIntervalo();
                activo = false;

                console.log(`se cargó todo en el proyecto: ${project.title}`);
                    // Evaluamos si el proyecto posee link
                    if (project.link == ""){
                        document.getElementById('linkIcon').style.display = 'none';
                    } else {
                        document.getElementById('linkIcon').style.display = '';
                    }
                })
                .catch(() => {
                // En caso de error en alguna imagen, mostramos el contenido de todas formas
                const temp = document.createElement('div');
                temp.innerHTML = proyecto;
                document.getElementById('project').replaceChildren(...temp.childNodes);

                detenerIntervalo();
                activo = false;
                });
            }
        })
        .catch(error => {
        console.error("Error al cargar los datos:", error);
        });
    };

    // Cerramos el proyecto y volvemos a la galería
    function getClose(id){
        document.getElementById('project').replaceChildren();

        document.getElementById(id).style="scroll-margin-top: 20px;"
        document.getElementById(id).scrollIntoView({ behavior: "smooth" }); // Volvemos el scroll a donde nos habíamos quedado
    }

    // Cambiar el color del fondo ----------------------------------------------------------------------------------------- //
    const colores = [
    "#FF5733", "#33FF57", "#3357FF", "#F39C12", "#9B59B6",
    "#1ABC9C", "#E74C3C", "#2ECC71"
    ];

    let indice = 0;
    let intervaloID = null; // para guardar el ID del setInterval
    let activo = false; // esto controla si está encendido o apagado

    function iniciarIntervalo() {
        if (intervaloID === null) { // prevenir múltiples intervalos superpuestos
            // Cambiar color inmediatamente
            document.body.style.backgroundColor = colores[indice];
            indice = (indice + 1) % colores.length;
            // Después arrancar el intervalo
            intervaloID = setInterval(() => {
            document.body.style.backgroundColor = colores[indice];
            indice = (indice + 1) % colores.length;
            }, 3000);
        }
    }

    function detenerIntervalo() {
        clearInterval(intervaloID);
        intervaloID = null; // reiniciar
        document.body.style.backgroundColor = "#FFFFFF";
    }

    document.getElementById('color').addEventListener("click", () => {
        if (!activo) {
            iniciarIntervalo();
        } else {
            detenerIntervalo();
        }
        activo = !activo; // alterna entre true/false
    });

    // MOVER SCROLL SEGÚN TOGGLE EN SKILLS--------------------------------------------------------------------------------- //
    document.addEventListener("DOMContentLoaded", function () {
    const toggle = document.getElementById("skillsToggle");
    const aboutSection = document.getElementById("toggle");

        toggle.addEventListener("change", function () {
            if (toggle.checked) {
            console.log("Toggle activado");
            aboutSection.scrollIntoView({ behavior: "smooth" });
            } else {
            console.log("Toggle desactivado");
            window.scrollTo({ top: 0, behavior: "smooth" });
            }
        });
    });
    
   </script>


    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
</body>
</html>